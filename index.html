<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stock Intrinsic Value Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background: #f7f7f7; border-radius: 8px; }
    h1 { text-align: center; }
    input, button { margin: 8px 0; padding: 8px; width: 100%; }
    .output { background: #fff; padding: 10px; border-radius: 6px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Intrinsic Value Calculator</h1>

  <label for="symbol">Enter Stock Symbol:</label>
  <input type="text" id="symbol" placeholder="e.g., AAPL">

  <label for="growth">Estimated Annual Growth Rate (%):</label>
  <input type="number" id="growth" placeholder="e.g., 8">

  <button onclick="calculateIntrinsicValue()">Calculate</button>
  <div class="output" id="result"></div>

  <script>
    const API_KEY = "d0kuab9r01qhb02558rgd0kuab9r01qhb02558s0";

    async function calculateIntrinsicValue() {
      const symbol = document.getElementById("symbol").value.toUpperCase();
      const growthInput = parseFloat(document.getElementById("growth").value) / 100;
      const resultDiv = document.getElementById("result");

      try {
        // Fetch stock profile
        const profileResponse = await fetch(`https://finnhub.io/api/v1/stock/profile2?symbol=${symbol}&token=${API_KEY}`);
        const profile = await profileResponse.json();

        // Fetch financial metrics
        const metricsResponse = await fetch(`https://finnhub.io/api/v1/stock/metric?symbol=${symbol}&metric=all&token=${API_KEY}`);
        const metrics = await metricsResponse.json();

        const eps = metrics.metric["epsTTM"] || 0;
        const growthRate = isNaN(growthInput) ? metrics.metric["growthQuarterlyYOY"] || 0.05 : growthInput;
        const discountRate = 0.10;
        const years = 5;

        // DCF calculation
        let intrinsicValue = 0;
        for (let i = 1; i <= years; i++) {
          intrinsicValue += (eps * Math.pow(1 + growthRate, i)) / Math.pow(1 + discountRate, i);
        }

        resultDiv.innerHTML = `
          <strong>${profile.name || symbol}</strong><br>
          EPS (TTM): $${eps.toFixed(2)}<br>
          Used Growth Rate: ${(growthRate * 100).toFixed(2)}%<br>
          Discount Rate: ${(discountRate * 100).toFixed(2)}%<br>
          <strong>Intrinsic Value (5yr DCF): $${intrinsicValue.toFixed(2)}</strong>
        `;
      } catch (error) {
        console.error("Error fetching data:", error);
        resultDiv.innerHTML = "⚠️ Could not retrieve data. Please check the symbol and try again.";
      }
    }
  </script>
</body>
</html>
