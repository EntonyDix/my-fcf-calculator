<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stock Intrinsic Value Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background: #f7f7f7; border-radius: 8px; }
    h1 { text-align: center; }
    input, button { margin: 8px 0; padding: 8px; width: 100%; }
    .output { background: #fff; padding: 10px; border-radius: 6px; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Intrinsic Value Calculator</h1>
  <label for="symbol">Enter Stock Symbol:</label>
  <input type="text" id="symbol" placeholder="e.g., AAPL">
  <button onclick="calculateIntrinsicValue()">Calculate</button>
  <div class="output" id="result"></div>

  <script>
    const API_KEY = "d0kuab9r01qhb02558rgd0kuab9r01qhb02558s0";

    async function calculateIntrinsicValue() {
      const symbol = document.getElementById("symbol").value.toUpperCase();
      const resultDiv = document.getElementById("result");

      try {
        // Get stock profile for name and other info
        const profileResponse = await fetch(`https://finnhub.io/api/v1/stock/profile2?symbol=${symbol}&token=${API_KEY}`);
        const profile = await profileResponse.json();

        // Get financials - using EPS and growth as proxies
        const metricsResponse = await fetch(`https://finnhub.io/api/v1/stock/metric?symbol=${symbol}&metric=all&token=${API_KEY}`);
        const metrics = await metricsResponse.json();

        const eps = metrics.metric["epsTTM"] || 0;
        const growthRate = metrics.metric["growthQuarterlyYOY"] || 0.05;
        const discountRate = 0.10;
        const years = 5;

        // DCF Calculation
        let intrinsicValue = 0;
        for (let i = 1; i <= years; i++) {
          intrinsicValue += (eps * Math.pow(1 + growthRate, i)) / Math.pow(1 + discountRate, i);
        }

        resultDiv.innerHTML = `
          <strong>${profile.name || symbol}</strong><br>
          Current EPS: ${eps.toFixed(2)}<br>
          Estimated Growth Rate: ${(growthRate * 100).toFixed(2)}%<br>
          Calculated Intrinsic Value (5yr DCF): <strong>$${intrinsicValue.toFixed(2)}</strong>
        `;
      } catch (error) {
        console.error("Error fetching data:", error);
        resultDiv.innerHTML = "⚠️ Could not retrieve data. Please try a valid symbol.";
      }
    }
  </script>
</body>
</html>
